# Instant-NGP Data Setup Guide

- Official Repository: https://github.com/NVlabs/instant-ngp
- Prepped Data
  - https://drive.google.com/drive/folders/1BPA51_wKRf4IfFY3YHJLomXAV66r1QVZ?usp=sharing

## 1. Verify Your Dataset Structure

- Dataset Structure Example:

```bash
/InstantNGP_Dataset/
│── transforms.json    # Stores camera poses & metadata (Generated by colmap2nerf.py)
│── /images/           # Full-resolution images
│── /colmap_text/      # COLMAP exported text files (cameras, images, points3D)
```

### Prerequisites

- Install [Miniconda](https://docs.conda.io/en/latest/miniconda.html)
- Create a new conda environment for instant-ngp:

```sh
conda create -n instant-ngp python=3.8 -y
conda activate instant-ngp
```

- Install required dependencies

```sh
pip install numpy json5 imageio tqdm opencv-python-headless
```

------

## 2. Prepare Your Dataset with COLMAP

### A. Install COLMAP (If Not Installed)

On MacOS (using Homebrew):

```sh
brew install colmap
```

On Linux (Ubuntu):

```sh
sudo apt-get install colmap
```

### B. Generate `transforms.json` File

- Use `colmap2nerf.py` to process your dataset.
- Example command to run:

```sh
python colmap2nerf.py --images images --colmap_matcher exhaustive --run_colmap --aabb_scale 32 --overwrite
```

- This will create `transforms.json` file in your dataset directory.

------

## 3. Train the Instant-NGP Model (Image NeRF Only)

## Building instant-ngp (Windows & Linux)

### Requirements

- An __NVIDIA GPU__; tensor cores increase performance when available. All shown results come from an RTX 3090.
- A __C++14__ capable compiler. The following choices are recommended and have been tested:
  - __Windows:__ Visual Studio 2019 or 2022
  - __Linux:__ GCC/G++ 8 or higher
- A recent version of __[CUDA](https://developer.nvidia.com/cuda-toolkit)__. The following choices are recommended and have been tested:
  - __Windows:__ CUDA 11.5 or higher
  - __Linux:__ CUDA 10.2 or higher
- __[CMake](https://cmake.org/) v3.21 or higher__.
- __(optional) [Python](https://www.python.org/) 3.7 or higher__ for interactive bindings. Also, run `pip install -r requirements.txt`.
- __(optional) [OptiX](https://developer.nvidia.com/optix) 7.6 or higher__ for faster mesh SDF training.
- __(optional) [Vulkan SDK](https://vulkan.lunarg.com/)__ for DLSS support.


If you are using Debian based Linux distribution, install the following packages

```sh
sudo apt-get install build-essential git python3-dev python3-pip libopenexr-dev libxi-dev \
                     libglfw3-dev libglew-dev libomp-dev libxinerama-dev libxcursor-dev
```

Alternatively, if you are using Arch or Arch derivatives, install the following packages

```sh
sudo pacman -S cuda base-devel cmake openexr libxi glfw openmp libxinerama libxcursor
```

We also recommend installing [CUDA](https://developer.nvidia.com/cuda-toolkit) and [OptiX](https://developer.nvidia.com/optix) in `/usr/local/` and adding the CUDA installation to your PATH.

For example, if you have CUDA 11.4, add the following to your `~/.bashrc`

```sh
export PATH="/usr/local/cuda-11.4/bin:$PATH"
export LD_LIBRARY_PATH="/usr/local/cuda-11.4/lib64:$LD_LIBRARY_PATH"
```


### Compilation

Begin by cloning this repository and all its submodules using the following command:

```sh
$ git clone --recursive https://github.com/nvlabs/instant-ngp
$ cd instant-ngp
```

Then, use CMake to build the project: (on Windows, this must be in a [developer command prompt](https://docs.microsoft.com/en-us/cpp/build/building-on-the-command-line?view=msvc-160#developer_command_prompt))

```sh
instant-ngp$ cmake . -B build -DCMAKE_BUILD_TYPE=RelWithDebInfo
instant-ngp$ cmake --build build --config RelWithDebInfo -j
```

If compilation fails inexplicably or takes longer than an hour, you might be running out of memory. Try running the above command without `-j` in that case.
If this does not help, please consult [this list of possible fixes](https://github.com/NVlabs/instant-ngp#troubleshooting-compile-errors) before opening an issue.

If the build succeeds, you can now run the code via the `./instant-ngp` executable or the `scripts/run.py` script described below.

If automatic GPU architecture detection fails, (as can happen if you have multiple GPUs installed), set the `TCNN_CUDA_ARCHITECTURES` environment variable for the GPU you would like to use. The following table lists the values for common GPUs. If your GPU is not listed, consult [this exhaustive list](https://developer.nvidia.com/cuda-gpus).

| H100 | 40X0 | 30X0 | A100 | 20X0 | TITAN V / V100 | 10X0 / TITAN Xp | 9X0  | K80  |
| :--: | :--: | :--: | :--: | :--: | :------------: | :-------------: | :--: | :--: |
|  90  |  89  |  86  |  80  |  75  |       70       |       61        |  52  |  37  |


## Python bindings

After you have built __instant-ngp__, you can use its Python bindings to conduct controlled experiments in an automated fashion.
All features from the interactive GUI (and more!) have Python bindings that can be easily instrumented.
For an example of how the `./instant-ngp` application can be implemented and extended from within Python, see `./scripts/run.py`, which supports a superset of the command line arguments that `./instant-ngp` does.

If you would rather build new models from the hash encoding and fast neural networks, consider [__tiny-cuda-nn__'s PyTorch extension](https://github.com/nvlabs/tiny-cuda-nn#pytorch-extension).

Happy hacking!